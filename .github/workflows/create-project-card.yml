name: Criar card no Project v2 pessoal a partir do Freshdesk

on:
  repository_dispatch:
    types: [create_card]

jobs:
  add_to_project:
    runs-on: ubuntu-latest
    steps:
      - name: Criar draft issue e mover para coluna
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
          PROJECT_ID: PVT_abc1234567890    # seu project ID aqui
          COLUMN_ID: PVTColumn_1234567890  # o ID da coluna
          TITLE: ${{ github.event.client_payload.title }}
          DESCRIPTION: ${{ github.event.client_payload.description }}
        run: |
          response=$(curl -s -X POST https://api.github.com/graphql \
            -H "Authorization: bearer $GH_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{\"query\": \"mutation { addProjectV2DraftIssue(input: {projectId: \\\"$PROJECT_ID\\\", title: \\\"$TITLE\\\", body: \\\"$DESCRIPTION\\\"}) { projectItem { id } } }\"}")

          item_id=$(echo "$response" | jq -r '.data.addProjectV2DraftIssue.projectItem.id')

          curl -s -X POST https://api.github.com/graphql \
            -H "Authorization: bearer $GH_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{\"query\": \"mutation { moveProjectV2ItemToColumn(input: {itemId: \\\"$item_id\\\", columnId: \\\"$COLUMN_ID\\\"}) { item { id } } }\"}"
EOF

