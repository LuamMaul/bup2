name: Criar card no Project v2 pessoal a partir do Freshdesk

on:
  repository_dispatch:
    types: [create_card]

jobs:
  add_to_project:
    runs-on: ubuntu-latest
    steps:
      - name: Criar draft issue no Project v2 pessoal
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
          PROJECT_ID: PVT_kwHOA0czfM4A8xv2
          TICKET_ID: ${{ github.event.client_payload.ticket_id }}
          TICKET_SUBJECT: ${{ github.event.client_payload.ticket_subject }}
        run: |
          TITLE="$TICKET_ID - $TICKET_SUBJECT"
          TICKET_LINK="https://SEUDOMINIO.freshdesk.com/helpdesk/tickets/$TICKET_ID"
          PLANILHA_LINK="https://docs.google.com/spreadsheets/d/1i_ceiljyTheYwYe5XJLmJn2uPJHy4kQVplLpbSDmWEs/edit?gid=1998271206#gid=1998271206"
          DESCRIPTION="[Ticket]($TICKET_LINK)%0A%0A[Planilha de MÃ©tricas]($PLANILHA_LINK)"

          curl -s -X POST https://api.github.com/graphql \
            -H "Authorization: bearer $GH_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{\"query\": \"mutation { addProjectV2DraftIssue(input: {projectId: \\\"$PROJECT_ID\\\", title: \\\"$TITLE\\\", body: \\\"$DESCRIPTION\\\"}) { projectItem { id } } }\"}"
