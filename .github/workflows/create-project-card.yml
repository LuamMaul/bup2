name: Criar card no Project v2 pessoal a partir do Freshdesk

on:
  repository_dispatch:
    types: [create_card]

jobs:
  add_to_project:
    runs-on: ubuntu-latest
    steps:
      - name: Criar card com título e descrição
        uses: actions/github-script@v7
        with:
          script: |
            const payload = context.payload.client_payload;
            const ticketId = payload.ticket_id;
            const ticketSubject = payload.ticket_subject;

            const title = `${ticketId} - ${ticketSubject}`;
            const ticketLink = `https://SEU_DOMINIO.freshdesk.com/helpdesk/tickets/${ticketId}`;
            const metricsLink = "https://docs.google.com/spreadsheets/d/1i_ceiljyTheYwYe5XJLmJn2uPJHy4kQVplLpbSDmWEs/edit?gid=1998271206#gid=1998271206";

            const description = `[Ticket](${ticketLink})\n\n[Planilha de Métricas](${metricsLink})`;

            await github.projects.createCard({
              column_id: SEU_ID_DA_COLUNA,
              note: `**${title}**\n\n${description}`
            });
